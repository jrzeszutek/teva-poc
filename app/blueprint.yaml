tosca_definitions_version: cloudify_dsl_1_3


imports:
  - https://cloudify.co/spec/cloudify/5.1.2/types.yaml
  - plugin:cloudify-ansible-plugin
  - VM--blueprint:linux-vm
  

node_templates:

  vm:
    type: cloudify.nodes.Compute
    properties:
      ip: { get_attribute: [ VM--terraform_module, resources, vm, instances, 0, attributes, ip ] }
      agent_config:
        install_method: none
        key: { get_attribute: [ VM--terraform_module, resources, vm, instances, 0, attributes, private_key_content ] }
        user: { get_attribute: [ VM--terraform_module, resources, vm, instances, 0, attributes, username ] }
    relationships:
      - type: cloudify.relationships.depends_on
        target: VM--terraform_module

  ansible_playbook:
    type: cloudify.nodes.ansible.Playbook
    properties:
      playbook_path: PUT PLAYBOOK PATH HERE (LOCAL OR URL)
    relationships:
      - type: cloudify.ansible.relationships.run_on_host
        target: vm


capabilities:
  ip:
    value: { get_attribute: [ vm, ip ] }
